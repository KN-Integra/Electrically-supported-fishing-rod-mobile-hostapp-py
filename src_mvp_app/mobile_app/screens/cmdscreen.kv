#:kivy 2.2.0
#:import utils kivy.utils

<CmdScreen>:
    canvas.before:
        Color:
            rgba: app.theme_cls.bg_light if app.theme_cls.theme_style == "Light" else app.theme_cls.bg_darkest
        Rectangle:
            pos: self.pos
            size: self.size

    MDBoxLayout:
        width: root.width
        height: root.height
        orientation: "vertical"
        spacing: "20dp"
        padding: "30dp"

        MDBoxLayout:
            orientation: "horizontal"
            size_hint: [1, 0.1]
            spacing: root.width // 2 if root.width > 600 else root.width // 3
            height: "20dp"

            Image:
                source: "media/integra-icon--light.png" if app.theme_cls.theme_style == "Light" else "media/integra-icon--dark.png"
                fit_mode: "contain"
                size_hint_y: None

            Image:
                source: "media/nordic_logo--light.png" if app.theme_cls.theme_style == "Light" else "media/nordic_logo--dark.png"
                fit_mode: "contain"
                size_hint_y: None

        MDScrollView:
            id: templates_view
            size_hint: [1, 0.5]

            MDGridLayout:
                id: templates_grid
                cols: 2 
                # TODO this should work, but apparently it does not
                # cols: (root.width // 200)
                size_hint_y: None
                orientation: "lr-tb"
                spacing: "15dp"

        MDRectangleFlatButton:
            size_hint: [1, 0.1]
            id: speed_label
            text: "Current speed: "
            on_release: root.speed_get()

            font_size: "20dp"

            padding: "20dp"
            width: root.width - 150
            margin: 0
            line_width: 2
            line_color: utils.rgba("#a18072")

            theme_text_color: "Custom"
            text_color: app.theme_cls.text_color

        MDBoxLayout:
            orientation: "horizontal"
            id: new_template

            size_hint: [1, 0.1]
            spacing: "20dp"

            MDTextField:
                id: new_template_name

                mode: "rectangle"
                hint_text: "Enter name"
                max_text_length: 20

                helper_text_mode: "on_error"
                helper_text: "Enter only latin letter with a maximum length of 20 chacters"

            MDTextField:
                id: new_template_speed
                
                mode: "rectangle"
                hint_text: "31999"
                input_type: "number"

            MDFloatingActionButton:
                on_release: root.template_add()

                icon: "plus"
                md_bg_color: app.theme_cls.icon_color if app.theme_cls.theme_style == "Light" else app.theme_cls.opposite_icon_color

        MDBoxLayout:
            orientation: "horizontal"
            # size_hint_y: None
            size_hint: [1, 0.1]
            spacing: "15dp"

            
            MDRectangleFlatButton:
                text: "Bootloader"
                on_release: root.enter_bootloader()
                disabled: self.state == "normal"

                font_size: "15dp"
                padding: "15dp"
                # width: root.width - 60
                size_hint_x: 0.5

                line_width: 2
                line_color: app.theme_cls.accent_color

                theme_text_color: "Custom"
                text_color: app.theme_cls.text_color
                
                # md_bg_color: utils.rgba("#fbbf24") if self.state=="normal" else utils.rgba("#f59e0b")
            
            MDRectangleFlatButton:
                text: "change theme"
                size_hint_x: 0.2

                font_size: "15dp"
                padding: "15dp"
                
                lnie_width: 2
                theme_text_color: "Custom"

                on_press: self.theme_cls.theme_style = "Dark" if self.theme_cls.theme_style == "Light" else "Light"

        MDRaisedButton:
            text: "Disconnect"
            on_release: root.disconnect()
            disabled: self.state != "normal"
            size_hint: [1, 0.1]
            
            font_size: "20dp"

            padding: "20dp"
            width: root.width - 150 

            line_width: 2

            # md_bg_color: utils.rgba("#f87171") if self.state=="normal" else utils.rgba("#dc2626")
            md_bg_color: app.theme_cls.error_color
